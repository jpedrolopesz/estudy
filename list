<template>

  <div class="mb-4">
      <label for="description" class="block my-2 text-sm font-medium text-gray-900">{{label}}
        <span v-if="required" class="text-danger-600">*</span>
      </label>
      <textarea id="description" rows="4" class="block p-2.5 w-full text-sm text-gray-900 bg-gray-50 rounded-lg border border-gray-300 focus:ring-gray-500 focus:border-gray-500"
                :value="modelValue"
                :maxlength="max"
                :required="required"
                :placeholder="placeholder"
                :autofocus="autofocus"
                :readonly="readonly"
                @input="$emit('update:modelValue', $event.target.value)"
                v-on:keyup="countdown"  >

      </textarea>
    <p class='text-right text-small'
       v-bind:class="{'text-danger': error }">{{max}}</p>

    </div>

  <div>
      <textarea id="description" rows="4" class="block p-2.5 w-full text-sm text-gray-900 bg-gray-50 rounded-lg border border-gray-300 focus:ring-gray-500 focus:border-gray-500"
      v-model="text"
      @input="updateCounter"
      :class="{'border-red-500': isOverLimit}"
    ></textarea>
    <p class="text-red-500" v-if="isOverLimit">
      Limite de caracteres excedido!
    </p>
    <p>{{ characterCount }} / {{ characterLimit }}</p>
  </div>
</template>


<script setup>
import { ref, computed } from 'vue';

defineProps({
  id: String,
  max: {
    type: Number,
    default: undefined
  },
  modelValue: { type: [String, Number], default: "" },
  error: { type: String, default: null },
  required: { type: Boolean, default: false },
  autofocus: { type: Boolean, default: false },
  placeholder: { type: String, default: "" },
  label: { type: String, default: "" },
  type: { type: String, default: "text" },
  readonly: { type: Boolean, default: false }
});

const emit = defineEmits(["update:modelValue", "blur"]);
const text = ref('');
const characterLimit = 100;

const characterCount = computed(() => {
  return text.value.length;
});

const isOverLimit = computed(() => {
  return characterCount.value > characterLimit;
});

function updateCounter() {
  if (characterCount.value > characterLimit) {
    text.value = text.value.slice(0, characterLimit);
  }
}
</script>

<style>
textarea {
  resize: vertical;
  min-height: 100px;
}
</style>


